# Безопасность токенов и конфиденциальных данных

## ✅ Ваш токен в безопасности!

Файл `.env` с токеном Telegram и другими конфиденциальными данными **НЕ попадает** в GitHub благодаря правильной настройке [`.gitignore`](.gitignore).

## Как это работает

### 1. Файл `.gitignore`

В файле [`.gitignore`](.gitignore) указаны паттерны файлов, которые Git игнорирует:

```gitignore
# Переменные окружения (конфиденциальные данные)
.env
.env.local
```

Это означает, что файл `.env` **никогда** не будет добавлен в репозиторий.

### 2. Файл `.env.example`

Вместо реального `.env` в репозитории находится [`.env.example`](.env.example) - шаблон без реальных токенов:

```env
BOT_TOKEN=your_bot_token_here
DATABASE_URL=postgresql://user:password@localhost:5432/family_bot
```

### 3. Проверка безопасности

Вы можете проверить, что `.env` не попал в репозиторий:

```bash
# Проверить, какие .env файлы в репозитории
git ls-files | grep .env

# Должно показать только:
# .env.example
```

```bash
# Проверить, что .env игнорируется
git check-ignore -v .env

# Должно показать:
# .gitignore:21:.env    .env
```

## Что делать, если токен случайно попал в GitHub

### 1. Немедленно отзовите токен

1. Откройте [@BotFather](https://t.me/BotFather)
2. Отправьте `/mybots`
3. Выберите вашего бота
4. Нажмите "API Token"
5. Нажмите "Revoke current token"
6. Получите новый токен

### 2. Удалите токен из истории Git

```bash
# ВНИМАНИЕ: Это перезапишет историю!
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch .env" \
  --prune-empty --tag-name-filter cat -- --all

# Принудительно отправьте изменения
git push origin --force --all
```

### 3. Обновите токен

1. Добавьте новый токен в `.env`
2. Обновите переменную `BOT_TOKEN` на Railway

## Рекомендации по безопасности

### ✅ Делайте:

- Используйте `.env` для всех конфиденциальных данных
- Проверяйте `.gitignore` перед первым коммитом
- Используйте `.env.example` как шаблон
- Регулярно меняйте токены и пароли
- Используйте разные токены для разработки и продакшн

### ❌ Не делайте:

- Не коммитьте файлы с токенами
- Не храните токены в коде
- Не публикуйте токены в issues или pull requests
- Не отправляйте токены в чатах
- Не используйте один токен для нескольких проектов

## Переменные окружения в проекте

Все конфиденциальные данные хранятся в переменных окружения:

| Переменная | Описание | Где используется |
|------------|----------|------------------|
| `BOT_TOKEN` | Токен Telegram бота | Авторизация бота |
| `DATABASE_URL` | URL базы данных PostgreSQL | Подключение к БД |
| `WEBHOOK_SECRET` | Секретный токен webhook | Безопасность webhook |
| `RAILWAY_STATIC_URL` | Домен приложения | Настройка webhook |

## Проверка перед коммитом

Перед каждым коммитом убедитесь:

```bash
# 1. Проверьте статус
git status

# 2. Убедитесь, что .env не в списке
# Если .env в списке - НЕ коммитьте!

# 3. Проверьте, что .env игнорируется
git check-ignore .env

# Должно вывести: .env
```

## Дополнительная защита

### GitHub Secrets Scanning

GitHub автоматически сканирует репозитории на наличие токенов. Если токен обнаружен:
1. Вы получите уведомление
2. Немедленно отзовите токен
3. Удалите его из истории Git

### Pre-commit hooks

Можно установить pre-commit hook для автоматической проверки:

```bash
# Установите pre-commit
pip install pre-commit

# Создайте .pre-commit-config.yaml
# Добавьте проверку на секреты
```

## Итог

✅ Ваш проект правильно настроен для безопасного хранения токенов
✅ Файл `.env` защищён от случайной публикации
✅ Используется `.env.example` для документации
✅ Все конфиденциальные данные в переменных окружения
